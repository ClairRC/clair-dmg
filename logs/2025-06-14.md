# June 14th, 2025

One thing that I did today was begin implementing an interrupt handler. Basically, it's pretty simple. It just checks if there are any interrupts waiting to be serviced that are also enabled, then jumps to the address after saving the PC to the stack. The system is pretty simple and effective, I think! 

The more annoying thing I did was continue to implement the timer registers like TIMA, DIV, and TMA. I think that I came to the conclusion though that I should not be as worried about accuracy as I have been. I spent multiple hours banging my head against the wall thinking about edge cases like "Should I update these after the instruction? What happens if they get written to? What happens to TIMA on the cycle it overflows? Should I update these before or after the interrupt handler? Should I call these mid-instruction for perfect accuracy?" I ended up reading some documentation for other emulators, and the ones that I read said something along the lines of... "After the instruction, update these timers! They update every blah blah cycles!" And so I started wondering if maybe I'm trying to be more accurate than is necessary for an emulator, especially a first emulator. Don't get me wrong, I think that having accurate behavior would be nice, and I want to capture that with things like the HALT bug, blocking memory access at certain times, getting interrupt timings correct, and weird MBC quirks... But at the end of the day, DIV is used generally for RNG seeding, and TIMA is used for triggering interrupts at a regular interval many times per frame. In the vast majority of cases across the vast majority of games, slight inaccuracies here will be very unnoticeable. As much as I'd like to get these things right, they don't appear to be the most important little edge cases at the moment. I decided that I'm going to try to go for even less perfect accuracy and just capture general behavior that works in the vast majority of cases, and then anything in particular I can go back and fix later. Spending like 6 hours per day just trying to understand the weird quirks is not very productive, and ultimately, emulating cycle-perfect timing is not usually necessary. Even the most accurate emulators are not 100% perfect.

Ultimately I do think that I want to have an emulator that captures a lot of weird quirks, but not every single one. I think that getting a working instruction loop and observing a ROM actually running would give me so much more information than trying to conceptualize what every single piece of hardware is doing at any given cycle. Accounting for these things would be necessary for very, very specific cases (mainly passing test ROMs...), but for my purposes, which is just to get a working emulator that works in the vast majority of cases, I think that I can live with "mostly good enough"....

That said, my next goal IS going to be getting that instruction loop working, including HALTing behavior and the HALT bug, interrupts, and timing behavior that is accurate for the vast majority of circumstances.
